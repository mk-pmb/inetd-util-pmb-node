# Local SSLification service to mitigate Hexchat bug #889
# https://github.com/hexchat/hexchat/issues/889

service irc_torssl_freenode
{
  socket_type = stream
  protocol = tcp
  type = UNLISTED
  interface = 127.0.0.1
  port = 6671
  user = proxy
  group = proxy

  wait = no
  server = /usr/lib/node_modules/inetd-util-pmb/bin/logwrap.sh
  env += LW_SERVER_CMD=/
  env += LW_SOURCE_INIT=/etc/profile
  server_args = torify socat STDIO OPENSSL:freenodeok2gncmy.onion:7000,verify=0
  env += LW_STDERR=/dev/null
  # ^-- mute torify's warnings ( tor.stackexchange.com/questions/10131/ )

  instances = 5
  # ^-- run at most this many
  nice = 10
  # ^-- run with low priority
  rlimit_as = 8M
  # ^-- should be enough RAM for a TORified socat.
}

# -*- coding: utf-8, tab-width: 2 -*-
